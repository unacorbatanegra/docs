<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-architecture">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">🏛️ Architecture | Shorebird</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.shorebird.dev/img/open-graph.png"><meta data-rh="true" name="twitter:image" content="https://docs.shorebird.dev/img/open-graph.png"><meta data-rh="true" property="og:url" content="https://docs.shorebird.dev/architecture"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="🏛️ Architecture | Shorebird"><meta data-rh="true" name="description" content="How Shorebird works."><meta data-rh="true" property="og:description" content="How Shorebird works."><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://docs.shorebird.dev/architecture"><link data-rh="true" rel="alternate" href="https://docs.shorebird.dev/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.shorebird.dev/architecture" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f326bf64.css">
<link rel="preload" href="/assets/js/runtime~main.a2a89d80.js" as="script">
<link rel="preload" href="/assets/js/main.9aa2d342.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Shorebird Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Shorebird Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Shorebird</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shorebirdtech/shorebird" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-icon" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">🚀 Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview">🌎 Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/code-push">☁️ Code Push</a><button aria-label="Toggle the collapsible sidebar category &#x27;☁️ Code Push&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code_push/initialize">✨ Initialize</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code_push/release">📦 Release</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code_push/preview">👀 Preview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code_push/patch">☁️ Patch</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/guides">🗺️ Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;🗺️ Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/code_push_quickstart">☄️ Code Push Quickstart</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/release">🚢 Release</a><button aria-label="Toggle the collapsible sidebar category &#x27;🚢 Release&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/release/android">🤖 Android</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/release/ios">🍎 iOS</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/staging-patches">🚦 Staging Patches</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/guides/flavors">🍧 Flavors</a><button aria-label="Toggle the collapsible sidebar category &#x27;🍧 Flavors&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/flavors/android">🤖 Android</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/flavors/ios">🍎 iOS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/guides/hybrid-app">🦿 Hybrid Apps</a><button aria-label="Toggle the collapsible sidebar category &#x27;🦿 Hybrid Apps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/hybrid-app/android">🤖 Android</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/hybrid-app/ios">🍎 iOS</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/crash-reporting">🚑 Crash Reporting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/ci">✅ Continuous Integration</a><button aria-label="Toggle the collapsible sidebar category &#x27;✅ Continuous Integration&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ci/github">🐙 GitHub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ci/codemagic">✨ Codemagic</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/flutter-version">🐦 Flutter Version</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/teams">👥 Teams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/update-strategies">⬆️ Update Strategies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/concepts">🎓 Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">❓ FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/status">👷 Status</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/architecture">🏛️ Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/uninstall">🛑 Uninstall</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/troubleshooting">🛠️ Troubleshooting</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">🏛️ Architecture</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Shorebird Architecture</h1><p>Shorebird is a set of tools that allow you to build and deploy new versions of
your Flutter app directly to your users&#x27; devices.</p><p>This document exists to explain how Shorebird works and to provide a high-level
overview of the components that make up the Shorebird system.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lifetime-of-a-shorebird-update">Lifetime of a Shorebird Update<a href="#lifetime-of-a-shorebird-update" class="hash-link" aria-label="Direct link to Lifetime of a Shorebird Update" title="Direct link to Lifetime of a Shorebird Update">​</a></h2><p>This assumes the developer already has installed Shorebird and has a working Flutter
project, as covered in the <a href="/">Getting Started</a> guide.</p><p><code>shorebird init</code> tells Shorebird servers to create a new &quot;App&quot; entry associated
with your account as well as writes the resulting app_id to <code>shorebird.yaml</code> in
your project.</p><p><code>shorebird release</code> builds your app using <code>flutter build</code> and then uploads
the resulting binary to a private Google Cloud Storage bucket. The command
also creates a &quot;release&quot; record in our database that associates the app_id
with the release version.</p><p><code>shorebird preview</code> can be used to download and run any of these privately
stored release binaries on your local device.</p><p>Developers then typically take the resulting .aab or .ipa and distribute it
to their users, typically via the Play Store or App Store.</p><p>At some point later, developers use <code>shorebird patch</code> to build a new version
of their app. <code>shorebird patch</code> then downloads the previous release binary
associated with that app_id and version number (patches use the same version
number as the release they are patching) and then builds a &quot;patch diff&quot; from
the combined release and patch binaries. This &quot;patch diff&quot; is then uploaded
to a public Google Cloud Storage bucket where it will be served to devices
requesting an update with the corresponding app_id and release version.</p><p><code>shorebird patch</code> also creates a record in our database that associates the
patch with the app_id and release version and alerts our &quot;patch check&quot; servers
that a new patch is available. Patches can optionally be &quot;staged&quot; when
uploaded. They will then not appear in patch checks until the patch &quot;channel&quot;
is set to &quot;stable&quot; by the developer in the Shorebird Console.</p><p>Release binaries which were built with Shorebird contain Shorebird&#x27;s updater
library. By default, the updater library will check for patches every time
the app is started. This is done via a background thread to not slow down
launch. The updater code makes a single request to our &quot;patch check&quot; servers
which are again Google Cloud Run instances. The &quot;patch check&quot; servers
respond with the URL of the patch diff if one is available.</p><p>A typical patch check is made via https, and contains:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;app_id&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;uuid...&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;channel&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;stable&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;release_version&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1.0.0&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;patch_number&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;platform&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;android&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;arch&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;arm64-v8a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A patch response contains:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;patch_available&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;patch&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;number&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;hash&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;sha256...&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;download_url&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;google cloud storage url&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code to do these checks is open source as part of the Updater library
and may change from what is documented above:
<a href="https://github.com/shorebirdtech/updater/blob/main/library/src/network.rs" target="_blank" rel="noopener noreferrer">https://github.com/shorebirdtech/updater/blob/main/library/src/network.rs</a></p><p>The updater library then downloads the patch diff and applies it to the
release binary. The patch diff is a binary diff. The updater library
also checks the hash of the patch diff to confirm download integrity.</p><p>The hash is not meant to be a security feature, but rather a way to detect
errors in the patch diff. A common error we see is that developers <code>shorebird
release</code> with one source and then actually build an release a different binary,
resulting then in invalid patches. This hash helps detect such errors. We
currently do not sign patches, but plan to add that capability in the near
future.</p><p>The modified Flutter engine also reports successful or failed launch of
a patch back to our servers the next time it makes a patch check.</p><p>A patch event contains:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;app_id&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;uuid...&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;arch&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;arm64-v8a&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;platform&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;android&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;PatchInstallSuccess&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;release_version&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1.0.0&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;patch_number&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These events are used to display patch install analytics in the Shorebird
Console.</p><p>If a patch fails to launch after install, in addition to sending a
&quot;PatchInstallFailure&quot; event, the updater library will also mark that patch
number as &quot;bad&quot; locally and refuse to boot the app with that patch number again.
This is to prevent a bad patch from causing a crash loop on the device.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="shorebird-components-and-source-code">Shorebird Components and Source Code<a href="#shorebird-components-and-source-code" class="hash-link" aria-label="Direct link to Shorebird Components and Source Code" title="Direct link to Shorebird Components and Source Code">​</a></h2><p>Shorebird consists of 3 major parts:</p><ul><li><code>shorebird</code> line tool that you use to build and deploy your app.</li><li>A modified Flutter engine that you include in your app.</li><li>Our public-cloud based infrastructure which hosts your app&#x27;s updates.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="shorebird-tool"><code>shorebird</code> tool<a href="#shorebird-tool" class="hash-link" aria-label="Direct link to shorebird-tool" title="Direct link to shorebird-tool">​</a></h3><p>The <code>shorebird</code> commands are documented on this site. Most of the build
logic is just wrapping the <code>flutter</code> tool and it also adds a few commands to
interface with Shorebird&#x27;s servers.</p><p>The source for the <code>shorebird</code> tool is available on GitHub:
<a href="https://github.com/shorebirdtech/shorebird/tree/main/packages/shorebird_cli" target="_blank" rel="noopener noreferrer">https://github.com/shorebirdtech/shorebird/tree/main/packages/shorebird_cli</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-modified-flutter">A Modified Flutter<a href="#a-modified-flutter" class="hash-link" aria-label="Direct link to A Modified Flutter" title="Direct link to A Modified Flutter">​</a></h3><p>Code push requires technical changes to the underlying Flutter engine. To make
those changes required forking Flutter.</p><p>We had to fork 4 Flutter and Dart repositories to make Shorebird work:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="flutterengine-the-flutter-engine">flutter/engine &quot;The Flutter Engine&quot;<a href="#flutterengine-the-flutter-engine" class="hash-link" aria-label="Direct link to flutter/engine &quot;The Flutter Engine&quot;" title="Direct link to flutter/engine &quot;The Flutter Engine&quot;">​</a></h4><p>The Flutter engine is the C++ code that runs on the device. It is responsible
for rendering the UI, handling input, and communicating with the host.</p><p>We forked this code to add the
<a href="https://github.com/shorebirdtech/updater" target="_blank" rel="noopener noreferrer">Shorebird updater</a>, which lets the
Flutter engine load new code from Shorebird&#x27;s servers.</p><p>Our Flutter Engine fork is public. You can see our engine changes on GitHub by
comparing our release branches to the upstream Flutter engine, e.g. for 3.16.9:
<a href="https://github.com/flutter/engine/compare/3.16.9...shorebirdtech:engine:flutter_release/3.16.9" target="_blank" rel="noopener noreferrer">https://github.com/flutter/engine/compare/3.16.9...shorebirdtech:engine:flutter_release/3.16.9</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="flutterflutter-the-flutter-framework">flutter/flutter &quot;The Flutter Framework&quot;<a href="#flutterflutter-the-flutter-framework" class="hash-link" aria-label="Direct link to flutter/flutter &quot;The Flutter Framework&quot;" title="Direct link to flutter/flutter &quot;The Flutter Framework&quot;">​</a></h4><p>The flutter/flutter repo contains the Dart code that runs on the device as well
as the <code>flutter</code> tool that is used to build and run Flutter apps.</p><p>We forked this code to be able to deliver our modified Flutter engine to change
the version of the engine that the <code>flutter</code> tool uses.</p><p>Our Flutter Framework fork is public. You can see our engine changes on GitHub
by comparing our release branches to the upstream Flutter Framework, e.g. for
3.16.9:
<a href="https://github.com/flutter/flutter/compare/3.16.9...shorebirdtech:flutter:flutter_release/3.16.9" target="_blank" rel="noopener noreferrer">https://github.com/flutter/flutter/compare/3.16.9...shorebirdtech:flutter:flutter_release/3.16.9</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="flutterbuildroot-the-buildroot">flutter/buildroot &quot;The Buildroot&quot;<a href="#flutterbuildroot-the-buildroot" class="hash-link" aria-label="Direct link to flutter/buildroot &quot;The Buildroot&quot;" title="Direct link to flutter/buildroot &quot;The Buildroot&quot;">​</a></h4><p>The buildroot repo contains the build scripts that are used to build the
Flutter engine for various platforms. It&#x27;s separate from flutter/engine in
order to share code and configuration with the Fuchsia build system.</p><p>We forked this code to make one small modification to the build setup to
allow exposing our updater symbols from the Flutter engine up to
package:shorebird_code_push.</p><p><a href="https://github.com/shorebirdtech/updater" target="_blank" rel="noopener noreferrer">https://github.com/shorebirdtech/updater</a>
is a Rust library which we link into the engine. The way we do that is via
a C-API on a static library (libupdater.a). The default flags for linking
for the Flutter engine hide all symbols from linked static libraries. We
need to be able to expose the shorebird<!-- -->_<!-- -->*<!-- --> symbols from libupdater.a up through
FFI to the Dart code. We did that by making one change to buildroot and then
a second change to the engine to place the symbols on the allow-list.</p><p><a href="https://github.com/flutter/buildroot/compare/3.16.9...shorebirdtech:buildroot:flutter_release/3.16.9" target="_blank" rel="noopener noreferrer">https://github.com/flutter/buildroot/compare/3.16.9...shorebirdtech:buildroot:flutter_release/3.16.9</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="installing-a-forked-flutter">Installing a Forked Flutter<a href="#installing-a-forked-flutter" class="hash-link" aria-label="Direct link to Installing a Forked Flutter" title="Direct link to Installing a Forked Flutter">​</a></h4><p>When you install Shorebird, it installs Flutter and Dart from our fork. These
are currently not exposed on the user&#x27;s path, rather private copies that
Shorebird will use when building your app.</p><p>This was necessary to avoid conflicts with other Flutter installations on the
user&#x27;s machine. Specifically, the way that Flutter downloads artifacts is based
on the version of the engine. If we were to use the same version of the engine
as the user&#x27;s Flutter installation, then we would overwrite the user&#x27;s engine
artifacts.</p><p>We deliver our artifacts to this fork of Flutter with two ways. First is we
change the version of the engine in the <code>flutter</code> tool. Second is we pass
FLUTTER_STORAGE_BASE_URL set to download.shorebird.dev (instead of
download.flutter.io) when calling our vended copy of the <code>flutter</code> tool.</p><p>Currently this means <code>shorebird</code> will not work in an environment where the
user needs to use FLUTTER_STORAGE_BASE_URL to download Flutter artifacts
from a private mirror (e.g. a corporate network or China).
<a href="https://github.com/shorebirdtech/shorebird/issues/237" target="_blank" rel="noopener noreferrer">https://github.com/shorebirdtech/shorebird/issues/237</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="serving-forked-binaries">Serving Forked Binaries<a href="#serving-forked-binaries" class="hash-link" aria-label="Direct link to Serving Forked Binaries" title="Direct link to Serving Forked Binaries">​</a></h4><p>We also use a custom server to handle requests from <code>flutter</code> for our
modified engine. The source for that server is here:
<a href="https://github.com/shorebirdtech/shorebird/tree/main/packages/artifact_proxy" target="_blank" rel="noopener noreferrer">https://github.com/shorebirdtech/shorebird/tree/main/packages/artifact_proxy</a></p><p>The artifact proxy is hosted at <a href="https://download.shorebird.dev" target="_blank" rel="noopener noreferrer">https://download.shorebird.dev</a> via Google Cloud Run.</p><p>This proxy knows how to serve the modified binaries from our Google Storage
bucket, as well as how to forward along requests to Google&#x27;s Flutter storage
bucket for unmodified binaries for all parts of Flutter we didn&#x27;t have to
modify.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="shorebirds-cloud-infrastructure">Shorebird&#x27;s Cloud Infrastructure<a href="#shorebirds-cloud-infrastructure" class="hash-link" aria-label="Direct link to Shorebird&#x27;s Cloud Infrastructure" title="Direct link to Shorebird&#x27;s Cloud Infrastructure">​</a></h3><p>Shorebird&#x27;s public-cloud based infrastructure is responsible for hosting your
app&#x27;s updates. It&#x27;s a set of services that handle the following:</p><ul><li>Release binary (private) storage</li><li>Patch binary (public) storage and serving (via global CDN)</li><li>Patch check requests (via Google Cloud Run)</li></ul><p>We also provide a web-based console for developers to manage their apps and
view analytics as well as the underlying database that powers the patch checks
and console.</p><p>Currently all of our infrastructure is hosted on Google Cloud Platform although
we will likely expand to other cloud providers over time. If we do, we will
update our privacy policy to reflect such. All of these services are currently
set to use US regions by default.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/shorebirdtech/docs/tree/main/docs/architecture.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/status"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">👷 Status</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/uninstall"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">🛑 Uninstall</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lifetime-of-a-shorebird-update" class="table-of-contents__link toc-highlight">Lifetime of a Shorebird Update</a></li><li><a href="#shorebird-components-and-source-code" class="table-of-contents__link toc-highlight">Shorebird Components and Source Code</a><ul><li><a href="#shorebird-tool" class="table-of-contents__link toc-highlight"><code>shorebird</code> tool</a></li><li><a href="#a-modified-flutter" class="table-of-contents__link toc-highlight">A Modified Flutter</a></li><li><a href="#shorebirds-cloud-infrastructure" class="table-of-contents__link toc-highlight">Shorebird&#39;s Cloud Infrastructure</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/code-push">Code Push</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://shorebird.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">shorebird.dev<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/shorebirdtech/shorebird" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/shorebird" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/shorebirddev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.a2a89d80.js"></script>
<script src="/assets/js/main.9aa2d342.js"></script>
</body>
</html>